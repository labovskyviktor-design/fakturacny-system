<!DOCTYPE html>
<html lang="sk">

<head>
    <meta charset="UTF-8">
    <title>Faktúra {{ invoice.invoice_number }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @page {
            size: A4 portrait;
            margin: 0;
        }

        body {
            font-family: 'DejaVu Sans', Arial, sans-serif;
            font-size: 10pt;
            color: #1e293b;
            line-height: 1.4;
            background: #fff;
            width: 794px;
            /* A4 width at 96 DPI */
            margin: 0 auto;
        }

        .container {
            width: 100%;
            padding: 1.5cm;
        }

        /* Helper for layouts without Flexbox */
        .layout-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        .layout-table td {
            vertical-align: top;
        }

        /* Hlavička */
        .header-section {
            border-bottom: 2px solid #1e40af;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .invoice-title {
            font-size: 26pt;
            font-weight: bold;
            color: #1e40af;
            letter-spacing: -0.5px;
        }

        .invoice-number-label {
            font-size: 12pt;
            color: #64748b;
            margin-top: 5px;
        }

        .supplier-brief {
            text-align: right;
            font-size: 9pt;
            color: #475569;
        }

        .supplier-brief b {
            font-size: 12pt;
            color: #1e293b;
            display: block;
            margin-bottom: 3px;
        }

        /* Strany */
        .party-box {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            height: 100%;
            border: 1px solid #e2e8f0;
        }

        .party-label {
            font-size: 8pt;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64748b;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .party-name {
            font-size: 12pt;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 8px;
        }

        .party-detail {
            font-size: 9.5pt;
            color: #334155;
            line-height: 1.5;
        }

        /* Info grid */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .info-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #f1f5f9;
        }

        .info-label {
            font-size: 9pt;
            color: #64748b;
            width: 150px;
        }

        .info-value {
            font-weight: bold;
            color: #1e293b;
            font-size: 10pt;
        }

        /* Tabuľka položiek */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .items-table th {
            background: #1e40af;
            color: white;
            font-size: 8.5pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px 10px;
            text-align: left;
        }

        .items-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 9.5pt;
            vertical-align: top;
        }

        .item-description {
            font-weight: bold;
            color: #0f172a;
        }

        .item-note {
            font-size: 8.5pt;
            color: #64748b;
            margin-top: 4px;
            font-weight: normal;
        }

        .text-right {
            text-align: right;
        }

        /* Súčty */
        .totals-section {
            margin-left: auto;
            width: 320px;
            margin-bottom: 30px;
        }

        .totals-table {
            width: 100%;
            border-collapse: collapse;
        }

        .totals-table td {
            padding: 6px 0;
            font-size: 10pt;
        }

        .totals-label {
            color: #64748b;
        }

        .total-final-row td {
            border-top: 2px solid #1e40af;
            padding-top: 15px;
            font-size: 15pt;
            font-weight: bold;
            color: #1e40af;
        }

        /* Platba a QR */
        .payment-box {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .qr-code-img {
            width: 140px;
            height: 140px;
        }

        /* Podpisy */
        .signature-table {
            width: 100%;
            margin-top: 40px;
        }

        .signature-cell {
            text-align: center;
            width: 50%;
            padding: 0 20px;
        }

        .signature-line {
            border-top: 1px solid #94a3b8;
            margin-top: 10px;
            padding-top: 5px;
            font-size: 8.5pt;
            color: #64748b;
        }

        .stamp-placeholder {
            height: 100px;
            position: relative;
        }

        /* Watermarks */
        .watermark {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 100pt;
            color: rgba(220, 38, 38, 0.08);
            font-weight: bold;
            z-index: -1;
        }

        .paid-stamp {
            position: fixed;
            top: 150px;
            right: 50px;
            border: 6px solid #22c55e;
            color: #22c55e;
            padding: 15px 30px;
            font-size: 32pt;
            font-weight: bold;
            transform: rotate(-15deg);
            border-radius: 12px;
            opacity: 0.7;
            z-index: 10;
        }
    </style>
</head>

<body>
    {% if invoice.status == 'cancelled' %}
    <div class="watermark">STORNO</div>
    {% endif %}

    {% if invoice.status == 'paid' %}
    <div class="paid-stamp">UHRADENÉ</div>
    {% endif %}

    <div class="container">
        <!-- Hlavička -->
        <div class="header-section">
            <table class="layout-table">
                <tr>
                    <td>
                        <div class="invoice-title">FAKTÚRA</div>
                        <div class="invoice-number-label">číslo {{ invoice.invoice_number }}</div>
                    </td>
                    <td class="supplier-brief">
                        <b>{{ invoice.supplier.name }}</b>
                        {{ invoice.supplier.street }}<br>
                        {{ invoice.supplier.zip_code }} {{ invoice.supplier.city }}, {{ invoice.supplier.country }}
                    </td>
                </tr>
            </table>
        </div>

        <!-- Dodávateľ a Odberateľ -->
        <table class="layout-table" style="margin-bottom: 25px;">
            <tr>
                <td style="padding-right: 15px; width: 50%;">
                    <div class="party-box">
                        <div class="party-label">Dodávateľ</div>
                        <div class="party-name">{{ invoice.supplier.name }}</div>
                        <div class="party-detail">
                            {{ invoice.supplier.street }}<br>
                            {{ invoice.supplier.zip_code }} {{ invoice.supplier.city }}<br>
                            {{ invoice.supplier.country }}<br>
                            <br>
                            {% if invoice.supplier.ico %}<b>IČO:</b> {{ invoice.supplier.ico }}<br>{% endif %}
                            {% if invoice.supplier.dic %}<b>DIČ:</b> {{ invoice.supplier.dic }}<br>{% endif %}
                            {% if invoice.supplier.ic_dph %}<b>IČ DPH:</b> {{ invoice.supplier.ic_dph }}<br>{% endif %}
                            {% if invoice.supplier.email %}<br>{{ invoice.supplier.email }}{% endif %}
                            {% if invoice.supplier.phone %}<br>{{ invoice.supplier.phone }}{% endif %}
                        </div>
                    </div>
                </td>
                <td style="padding-left: 15px; width: 50%;">
                    <div class="party-box">
                        <div class="party-label">Odberateľ</div>
                        <div class="party-name">{{ invoice.client.name }}</div>
                        <div class="party-detail">
                            {% if invoice.client.contact_person %}<b>{{ invoice.client.contact_person }}</b><br>{% endif
                            %}
                            {{ invoice.client.street }}<br>
                            {{ invoice.client.zip_code }} {{ invoice.client.city }}<br>
                            {{ invoice.client.country }}<br>
                            <br>
                            {% if invoice.client.ico %}<b>IČO:</b> {{ invoice.client.ico }}<br>{% endif %}
                            {% if invoice.client.dic %}<b>DIČ:</b> {{ invoice.client.dic }}<br>{% endif %}
                            {% if invoice.client.ic_dph %}<b>IČ DPH:</b> {{ invoice.client.ic_dph }}{% endif %}
                        </div>
                    </div>
                </td>
            </tr>
        </table>

        <!-- Údaje o platbe -->
        <table class="info-table">
            <tr>
                <td class="info-label">Variabilný symbol:</td>
                <td class="info-value">{{ invoice.variable_symbol }}</td>
                <td class="info-label">Dátum vystavenia:</td>
                <td class="info-value">{{ format_date_sk(invoice.issue_date) }}</td>
            </tr>
            <tr>
                <td class="info-label">Forma úhrady:</td>
                <td class="info-value">{{ get_payment_method_label(invoice.payment_method) }}</td>
                <td class="info-label">Dátum dodania:</td>
                <td class="info-value">{{ format_date_sk(invoice.delivery_date) }}</td>
            </tr>
            <tr>
                <td class="info-label">Mena:</td>
                <td class="info-value">EUR (€)</td>
                <td class="info-label" style="color: #dc2626; font-weight: bold;">Dátum splatnosti:</td>
                <td class="info-value" style="color: #dc2626;">{{ format_date_sk(invoice.due_date) }}</td>
            </tr>
        </table>

        <!-- Položky -->
        <table class="items-table">
            <thead>
                <tr>
                    <th style="width: 45%;">Popis položky</th>
                    <th style="width: 10%;" class="text-right">Množ.</th>
                    <th style="width: 10%;">Jedn.</th>
                    <th style="width: 15%;" class="text-right">Cena/j.</th>
                    <th style="width: 20%;" class="text-right">Suma celkom</th>
                </tr>
            </thead>
            <tbody>
                {% for item in invoice.items %}
                <tr>
                    <td>
                        <div class="item-description">{{ item.description }}</div>
                        {% if item.item_note %}<div class="item-note">{{ item.item_note }}</div>{% endif %}
                    </td>
                    <td class="text-right">{{ item.quantity }}</td>
                    <td>{{ item.unit }}</td>
                    <td class="text-right">{{ format_currency(item.unit_price) }} €</td>
                    <td class="text-right">{{ format_currency(item.total) }} €</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Sumár cien -->
        <div class="totals-section">
            <table class="totals-table">
                <tr>
                    <td class="totals-label">Základ pre DPH:</td>
                    <td class="text-right">{{ format_currency(invoice.subtotal) }} €</td>
                </tr>
                {% if invoice.vat_rate > 0 %}
                <tr>
                    <td class="totals-label">DPH ({{ invoice.vat_rate|int }}%):</td>
                    <td class="text-right">{{ format_currency(invoice.vat_amount) }} €</td>
                </tr>
                {% endif %}
                <tr class="total-final-row">
                    <td>Celkom k úhrade:</td>
                    <td class="text-right">{{ format_currency(invoice.total) }} €</td>
                </tr>
            </table>
        </div>

        <div style="font-size: 9pt; color: #475569; margin-bottom: 25px;">
            <b>Suma slovom:</b> {{ suma_slovom(invoice.total) }}
        </div>

        <!-- Banka a QR -->
        {% if invoice.payment_method == 'prevod' and invoice.supplier.iban %}
        <div class="payment-box">
            <table class="layout-table">
                <tr>
                    <td style="width: 65%;">
                        <div
                            style="font-size: 8pt; text-transform: uppercase; letter-spacing: 1px; color: #64748b; font-weight: bold; margin-bottom: 15px;">
                            Bankové spojenie
                        </div>
                        <table class="layout-table">
                            {% if invoice.supplier.bank_name %}
                            <tr>
                                <td style="width: 100px; font-size: 9pt; color: #64748b; padding-bottom: 5px;">Banka:
                                </td>
                                <td style="font-weight: bold; padding-bottom: 5px;">{{ invoice.supplier.bank_name }}
                                </td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td style="width: 100px; font-size: 9pt; color: #64748b; padding-bottom: 5px;">IBAN:
                                </td>
                                <td style="font-weight: bold; font-size: 11pt; padding-bottom: 5px; color: #1e40af;">{{
                                    invoice.supplier.iban }}</td>
                            </tr>
                            {% if invoice.supplier.swift %}
                            <tr>
                                <td style="width: 100px; font-size: 9pt; color: #64748b; padding-bottom: 5px;">
                                    SWIFT/BIC:</td>
                                <td style="font-weight: bold; padding-bottom: 5px;">{{ invoice.supplier.swift }}</td>
                            </tr>
                            {% endif %}
                        </table>
                    </td>
                    {% if qr_code %}
                    <td style="width: 35%; text-align: center;">
                        <div
                            style="font-size: 8pt; text-transform: uppercase; font-weight: bold; color: #64748b; margin-bottom: 5px;">
                            PAY by square</div>
                        <img src="{{ qr_code }}" class="qr-code-img" alt="QR Platba">
                    </td>
                    {% endif %}
                </tr>
            </table>
        </div>
        {% endif %}

        {% if invoice.note %}
        <div style="background: #f1f5f9; padding: 15px; border-radius: 6px; font-size: 9pt; margin-bottom: 30px;">
            <b style="display: block; margin-bottom: 5px;">Poznámka:</b>
            {{ invoice.note }}
        </div>
        {% endif %}

        <!-- Podpisy -->
        <table class="signature-table">
            <tr>
                <td class="signature-cell">
                    <div class="stamp-placeholder"></div>
                    <div class="signature-line">Vystavil</div>
                </td>
                <td class="signature-cell">
                    <div class="stamp-placeholder">
                        {% if invoice.supplier.stamp_image %}
                        <img src="{{ invoice.supplier.stamp_image }}" style="max-height: 90px; max-width: 180px;"
                            alt="Pečiatka">
                        {% endif %}
                        {% if invoice.supplier.signature_image %}
                        <img src="{{ invoice.supplier.signature_image }}"
                            style="max-height: 60px; max-width: 150px; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);"
                            alt="Podpis">
                        {% endif %}
                    </div>
                    <div class="signature-line">Pečiatka a podpis</div>
                </td>
            </tr>
        </table>

        <!-- Päta -->
        <div
            style="margin-top: 40px; border-top: 1px solid #e2e8f0; padding-top: 10px; text-align: center; font-size: 8pt; color: #94a3b8;">
            {% if not invoice.supplier.is_vat_payer %}
            Nie sme platcami DPH podľa §4 zákona č. 222/2004 Z.z. o DPH.
            {% else %}
            Platca DPH.
            {% endif %}
            <br>
            Generované systémom FakturaSK
        </div>
    </div>
</body>

</html>