[phases.setup]
nixPkgs = ["python311", "gcc", "pkg-config", "postgresql", "dejavu_fonts", "fontconfig", "cairo", "pango", "gdk-pixbuf", "libffi", "libxml2", "libxslt", "shared-mime-info", "glib", "gobject-introspection", "gtk3", "findutils"]

[phases.build]
cmds = [
    "pip install -r requirements.txt",
    "echo '--- SHARED LIBRARY DISCOVERY (FOR RAILWAY VARIABLES) ---'",
    "find /nix/store -name 'libgobject-2.0.so.0' -type f -print -quit || echo 'Not found in Nix store'",
    "echo '--- END DISCOVERY ---'"
]

[variables]
PYTHONPATH = ".:$PYTHONPATH"

[phases.install]
cmds = ["pip install -r requirements.txt"]

[phases.build]
cmds = []

[start]
cmd = "gunicorn app:app --bind 0.0.0.0:$PORT --workers 1 --threads 4 --timeout 120 --log-level debug --capture-output --enable-stdio-inheritance"
